<canvas id="stars-canvas" class="stars-background"></canvas>

<div class="premium-reading-wrapper">
  <div class="premium-reading-card">

    <div class="premium-header">
      <div class="cosmic-decoration">âœ¨ ğŸŒ™ â­ ğŸŒ™ âœ¨</div>
      <h1 class="premium-title">Your Cosmic Reading</h1>
      <div class="premium-subtitle">
        A glimpse into your <%= @reading.category_tarot.capitalize %> journey
      </div>
      <div class="premium-date">
        <%= @reading.date.strftime("%B %d, %Y") %>
      </div>
    </div>

    <%# EXTRAER CARTAS %>
    <% tarot_cards = extract_tarot_cards(@reading.content) %>

    <%# FALLBACK SI NO HAY CARTAS %>
    <% if tarot_cards.empty? %>
      <% tarot_cards = [
        { filename: "00-TheFool", display_name: "The Fool" },
        { filename: "01-TheMagician", display_name: "The Magician" },
        { filename: "02-TheHighPriestess", display_name: "The High Priestess" },
        { filename: "Cups02", display_name: "Two of Cups" },
        { filename: "Swords13", display_name: "Queen of Swords" },
        { filename: "Wands08", display_name: "Eight of Wands" },
        { filename: "Pentacles10", display_name: "Ten of Pentacles" },
        { filename: "17-TheStar", display_name: "The Star" },
        { filename: "18-TheMoon", display_name: "The Moon" },
        { filename: "19-TheSun", display_name: "The Sun" }
      ] %>
    <% end %>

    <%# CARRUSEL %>
    <div class="tarot-carousel-container">
      <div class="tarot-carousel">

        <button class="carousel-nav prev" aria-label="Previous card">
          <span>â®</span>
        </button>

        <div class="carousel-track-container">
          <div class="carousel-track">
            <% tarot_cards.first(10).each_with_index do |card, index| %>
              <div class="carousel-card <%= 'active' if index == 0 %>" data-card="<%= index %>">
                <div class="card-inner">
                  <%= image_tag "/cards/#{card[:filename]}.jpg",
                                alt: card[:display_name],
                                class: "tarot-card-image",
                                onerror: "this.src='/cards/00-TheFool.jpg'" %>
                </div>
                <div class="card-label">
                  <%= card[:display_name] %>
                </div>
              </div>
            <% end %>
          </div>
        </div>

        <button class="carousel-nav next" aria-label="Next card">
          <span>â¯</span>
        </button>

        <%# INDICADORES DENTRO DEL CARRUSEL %>
        <div class="carousel-indicators">
          <% tarot_cards.first(10).each_with_index do |card, i| %>
            <button class="indicator <%= 'active' if i == 0 %>" data-slide="<%= i %>"></button>
          <% end %>
        </div>

      </div>
    </div>

    <%# CONTENIDO %>
    <div class="premium-content-glass">
      <div class="premium-greeting">
        Dear <span class="highlight-name"><%= current_user.first_name || 'Seeker' %></span>,
      </div>

      <div class="premium-reading-text">
        <%= format_tarot_reading(@reading.content) %>
      </div>

      <div class="premium-signature">
        <div class="signature-line"></div>
        <div class="signature-text">May the stars guide your path</div>
        <div class="signature-line"></div>
      </div>
    </div>

    <%# BOTONES %>
    <div class="premium-actions">
      <%= link_to services_path, class: "premium-action-btn primary" do %>
        <span class="btn-icon">ğŸŒŸ</span>
        <span class="btn-text">Explore More Services</span>
      <% end %>

      <%= link_to dashboard_path, class: "premium-action-btn secondary" do %>
        <span class="btn-icon">ğŸ </span>
        <span class="btn-text">My Past Readings</span>
      <% end %>
    </div>

  </div>
</div>



<%# ============================================ %>
<%# JAVASCRIPT - AL FINAL DEL ARCHIVO %>
<%# ============================================ %>
<script defer>
document.addEventListener('DOMContentLoaded', function() {
  console.log('ğŸ´ DOM loaded, initializing carousel...');

  const track = document.querySelector('.carousel-track');
  const cards = document.querySelectorAll('.carousel-card');
  const prevBtn = document.querySelector('.carousel-nav.prev');
  const nextBtn = document.querySelector('.carousel-nav.next');
  const indicators = document.querySelectorAll('.indicator');

  console.log('Elements found:', {
    track: track,
    cardsCount: cards.length,
    prevBtn: prevBtn,
    nextBtn: nextBtn,
    indicatorsCount: indicators.length
  });

  if (!track || cards.length === 0 || !prevBtn || !nextBtn) {
    console.error('âŒ Missing carousel elements!');
    return;
  }

  let currentIndex = 0;
  const CARD_WIDTH = 280;
  const GAP = 32;

  function moveToCard(index) {
    console.log('ğŸ“ Moving to card:', index);

    const offset = -(index * (CARD_WIDTH + GAP));
    track.style.transform = 'translateX(' + offset + 'px)';
    track.style.transition = 'transform 0.5s cubic-bezier(0.4, 0, 0.2, 1)';

    cards.forEach(function(card, i) {
      if (i === index) {
        card.classList.add('active');
      } else {
        card.classList.remove('active');
      }
    });

    indicators.forEach(function(indicator, i) {
      if (i === index) {
        indicator.classList.add('active');
      } else {
        indicator.classList.remove('active');
      }
    });

    prevBtn.disabled = (index === 0);
    nextBtn.disabled = (index === cards.length - 1);

    currentIndex = index;
  }

  prevBtn.addEventListener('click', function() {
    console.log('â¬…ï¸ Previous button clicked, currentIndex:', currentIndex);
    if (currentIndex > 0) {
      moveToCard(currentIndex - 1);
    }
  });

  nextBtn.addEventListener('click', function() {
    console.log('â¡ï¸ Next button clicked, currentIndex:', currentIndex);
    if (currentIndex < cards.length - 1) {
      moveToCard(currentIndex + 1);
    }
  });

  indicators.forEach(function(indicator, index) {
    indicator.addEventListener('click', function() {
      console.log('ğŸ”˜ Indicator clicked:', index);
      moveToCard(index);
    });
  });

  // Teclas de flecha
  document.addEventListener('keydown', function(e) {
    if (e.key === 'ArrowLeft' && currentIndex > 0) {
      console.log('â¬…ï¸ Arrow Left pressed');
      moveToCard(currentIndex - 1);
    } else if (e.key === 'ArrowRight' && currentIndex < cards.length - 1) {
      console.log('â¡ï¸ Arrow Right pressed');
      moveToCard(currentIndex + 1);
    }
  });

  // Inicializar
  moveToCard(0);
  console.log('âœ… Carousel initialized successfully!');
});
</script>

<% content_for :body_class, 'has-stars-canvas' %>
